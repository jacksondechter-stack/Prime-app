"use client";
import { useState, useCallback, useMemo, useRef, useEffect } from "react";
import { signup as apiSignup, login as apiLoginFn, getMe, saveLog, updateProfile, logout as apiLogoutFn, debouncedSaveLog, getToken } from "../lib/api-client";
const ds=(d=new Date())=>d.toISOString().split("T")[0];
const dB=(a,b)=>Math.round((new Date(b+"T12:00:00")-new Date(a+"T12:00:00"))/864e5);
const hr=()=>new Date().getHours();
const mbt=()=>{const h=hr();return h<11?"b":h<15?"l":h<17?"s":"d"};
function estBF(w,h,a,s){const b=(w/(h*h))*703;return s==="male"?Math.round(Math.max(5,Math.min(45,1.2*b+.23*a-16.2))):Math.round(Math.max(10,Math.min(50,1.2*b+.23*a-5.4)));}
function bfL(bf,s){if(s==="male"){if(bf<=8)return{l:"Shredded",c:"#30d158"};if(bf<=14)return{l:"Athletic",c:"#34c759"};if(bf<=17)return{l:"Fit",c:"#0a84ff"};if(bf<=24)return{l:"Average",c:"#ffd60a"};return{l:"Above Avg",c:"#ff9f0a"};}if(bf<=22)return{l:"Athletic",c:"#34c759"};if(bf<=25)return{l:"Fit",c:"#0a84ff"};if(bf<=31)return{l:"Average",c:"#ffd60a"};return{l:"Above Avg",c:"#ff9f0a"};}
function cTDEE(w,h,a,s,act){const wK=w*.4536,hC=h*2.54,bmr=s==="male"?10*wK+6.25*hC-5*a+5:10*wK+6.25*hC-5*a-161;const m=act==="Not training"?1.2:act==="1-2x/week"?1.3:act==="3-4x/week"?1.45:1.55;return Math.round(bmr*m);}
function validPw(pw){return pw.length>=6&&/[A-Z]/.test(pw);}
function compressImage(file,maxW=800){return new Promise((res,rej)=>{const r=new FileReader();r.onload=e=>{const img=new Image();img.onload=()=>{const c=document.createElement("canvas");let w=img.width,h=img.height;if(w>maxW){h=Math.round(h*maxW/w);w=maxW;}c.width=w;c.height=h;c.getContext("2d").drawImage(img,0,0,w,h);res(c.toDataURL("image/jpeg",0.7).split(",")[1]);};img.onerror=rej;img.src=e.target.result;};r.onerror=rej;r.readAsDataURL(file);});}

const CM={"Running (easy)":8,"Running (moderate)":10,"Running (hard)":12,"Walking":3.5,"Cycling":7,"Swimming":8,"Basketball":6.5,"Soccer":7,"Hiking":5.5,"Jump Rope":11,"Rowing":7,"Elliptical":5,"Stair Climber":6,"Boxing/MMA":9,"Yoga":3,"Other":5};
const FDB=[{n:"Chicken Breast 4oz",cal:187,p:35,c:0,f:4},{n:"Chicken Breast 6oz",cal:280,p:53,c:0,f:6},{n:"Chicken Breast 8oz",cal:374,p:70,c:0,f:8},{n:"Chicken Thigh 6oz",cal:320,p:40,c:0,f:17},{n:"Ground Turkey 6oz",cal:300,p:45,c:0,f:12},{n:"Ground Beef 6oz",cal:430,p:42,c:0,f:28},{n:"Salmon 6oz",cal:350,p:40,c:0,f:20},{n:"Steak 6oz",cal:320,p:46,c:0,f:14},{n:"Shrimp 6oz",cal:170,p:36,c:1,f:2},{n:"Tuna Can",cal:120,p:28,c:0,f:1},{n:"Eggs x1",cal:70,p:6,c:0,f:5},{n:"Eggs x2",cal:140,p:12,c:1,f:10},{n:"Eggs x3",cal:210,p:18,c:1,f:15},{n:"Egg Whites x4",cal:68,p:14,c:1,f:0},{n:"Greek Yogurt",cal:130,p:22,c:8,f:0},{n:"Cottage Cheese",cal:220,p:28,c:8,f:9},{n:"Protein Shake",cal:160,p:30,c:5,f:2},{n:"Protein Bar",cal:220,p:20,c:25,f:8},{n:"White Rice 1cup",cal:206,p:4,c:45,f:0},{n:"Brown Rice 1cup",cal:216,p:5,c:45,f:2},{n:"Sweet Potato",cal:103,p:2,c:24,f:0},{n:"Pasta 1cup",cal:220,p:8,c:43,f:1},{n:"Oatmeal 1cup",cal:154,p:6,c:27,f:3},{n:"Bread 1slice",cal:80,p:3,c:15,f:1},{n:"Bread 2slices",cal:160,p:6,c:30,f:2},{n:"Bagel",cal:270,p:10,c:53,f:2},{n:"Tortilla",cal:120,p:3,c:20,f:3},{n:"Broccoli 1cup",cal:55,p:4,c:11,f:0},{n:"Avocado half",cal:120,p:2,c:6,f:11},{n:"Banana",cal:105,p:1,c:27,f:0},{n:"Apple",cal:95,p:0,c:25,f:0},{n:"PB 2tbsp",cal:190,p:7,c:7,f:16},{n:"Almonds 1oz",cal:164,p:6,c:6,f:14},{n:"Cheese 1oz",cal:110,p:7,c:0,f:9},{n:"Doritos 1oz",cal:140,p:2,c:18,f:7},{n:"Nacho Cheese Doritos",cal:140,p:2,c:18,f:7},{n:"Doritos bag",cal:250,p:3,c:32,f:13},{n:"Lays Chips 1oz",cal:160,p:2,c:15,f:10},{n:"Cheetos 1oz",cal:150,p:2,c:15,f:10},{n:"Popcorn 3cups",cal:93,p:3,c:19,f:1},{n:"Chipotle Bowl",cal:750,p:45,c:75,f:25},{n:"Chipotle Burrito",cal:1000,p:50,c:100,f:38},{n:"Pizza Slice",cal:285,p:12,c:36,f:10},{n:"Pizza 2 Slices",cal:570,p:24,c:72,f:20},{n:"Burger",cal:540,p:25,c:40,f:29},{n:"Cheeseburger",cal:600,p:28,c:42,f:33},{n:"Wings 10pc",cal:800,p:55,c:10,f:60},{n:"Wings 6pc",cal:480,p:33,c:6,f:36},{n:"Fries small",cal:230,p:3,c:30,f:11},{n:"Fries medium",cal:365,p:4,c:48,f:17},{n:"Fries large",cal:490,p:6,c:63,f:23},{n:"Chicken Tenders 4pc",cal:470,p:28,c:30,f:25},{n:"Chicken Nuggets 10pc",cal:430,p:22,c:26,f:27},{n:"Sushi Roll",cal:350,p:15,c:50,f:8},{n:"Salad + Chicken",cal:380,p:35,c:20,f:18},{n:"Sub 6in",cal:450,p:25,c:50,f:16},{n:"Tacos x2",cal:340,p:16,c:30,f:16},{n:"Tacos x3",cal:510,p:24,c:45,f:24},{n:"Burrito",cal:580,p:28,c:60,f:24},{n:"Quesadilla",cal:500,p:22,c:40,f:28},{n:"Cereal + milk",cal:260,p:6,c:45,f:5},{n:"Pancakes x3",cal:380,p:10,c:55,f:14},{n:"Smoothie protein",cal:300,p:30,c:35,f:5},{n:"Acai Bowl",cal:450,p:8,c:70,f:15},{n:"Mac & Cheese",cal:400,p:15,c:48,f:17},{n:"PB&J",cal:380,p:13,c:50,f:16},{n:"Grilled Cheese",cal:400,p:14,c:32,f:24},{n:"Ice Cream 1cup",cal:270,p:5,c:30,f:14},{n:"Cookie",cal:200,p:2,c:28,f:10},{n:"Brownie",cal:250,p:3,c:35,f:12},{n:"Donut",cal:250,p:4,c:30,f:13},{n:"Coffee black",cal:5,p:0,c:0,f:0},{n:"Latte",cal:190,p:10,c:18,f:7},{n:"Soda 12oz",cal:140,p:0,c:39,f:0},{n:"Chick-fil-A Sandwich",cal:440,p:28,c:40,f:19},{n:"Chick-fil-A Nuggets 8pc",cal:260,p:28,c:11,f:12},{n:"Big Mac",cal:550,p:25,c:45,f:30},{n:"Popeyes Sandwich",cal:700,p:28,c:50,f:42},{n:"Wendy\'s Baconator",cal:960,p:57,c:38,f:65}];
function sF(q){if(!q||q.length<2)return[];return FDB.filter(f=>f.n.toLowerCase().includes(q.toLowerCase())).slice(0,8);}
const JUNK=new Set(["Doritos","Nacho Cheese Doritos","Doritos bag","Lays Chips","Cheetos","Pizza Slice","Pizza 2 Slices","Burger","Cheeseburger","Wings 10pc","Wings 6pc","Fries small","Fries medium","Fries large","Chicken Tenders 4pc","Chicken Nuggets 10pc","Big Mac","Popeyes Sandwich","Wendy\'s Baconator","Ice Cream 1cup","Cookie","Brownie","Donut","Soda 12oz","Mac & Cheese"]);
function isJunk(name){return JUNK.has(name)||false;}
const ALC={"Vodka Soda":97,"Captain & Coke":185,"Rum & Coke":185,"IPA":210,"Light Beer":103,"Regular Beer":153,"Craft Beer":250,"Wine":125,"Margarita":274,"Whiskey Neat":105,"Gin & Tonic":171,"Shot":97,"Hard Seltzer":100,"Long Island":320,"Tequila Soda":97};
const WO={Push:[{n:"Bench Press",s:4,r:"8-10",m:"Chest",met:5},{n:"Incline DB Press",s:3,r:"10-12",m:"Upper Chest",met:4.5},{n:"Overhead Press",s:4,r:"8-10",m:"Shoulders",met:5},{n:"Lateral Raises",s:3,r:"12-15",m:"Side Delts",met:3.5},{n:"Tricep Pushdowns",s:3,r:"12-15",m:"Triceps",met:3},{n:"Overhead Tri Ext",s:3,r:"10-12",m:"Triceps",met:3}],Pull:[{n:"Barbell Rows",s:4,r:"8-10",m:"Back",met:5},{n:"Lat Pulldowns",s:3,r:"10-12",m:"Lats",met:4.5},{n:"Cable Rows",s:3,r:"10-12",m:"Mid Back",met:4},{n:"Face Pulls",s:3,r:"15-20",m:"Rear Delts",met:3},{n:"Barbell Curls",s:3,r:"10-12",m:"Biceps",met:3.5},{n:"Hammer Curls",s:3,r:"10-12",m:"Biceps",met:3.5}],Legs:[{n:"Squats",s:4,r:"8-10",m:"Quads",met:6},{n:"Romanian Deadlifts",s:4,r:"8-10",m:"Hams",met:5.5},{n:"Leg Press",s:3,r:"10-12",m:"Quads",met:5},{n:"Leg Curls",s:3,r:"12-15",m:"Hams",met:3.5},{n:"Calf Raises",s:4,r:"15-20",m:"Calves",met:3},{n:"Walking Lunges",s:3,r:"12 each",m:"Glutes",met:5}]};
const SCH=["Push","Pull","Legs","Push","Pull","Rest","Rest"];

const FF="'Plus Jakarta Sans',system-ui,sans-serif";
const IS={width:"100%",padding:"14px 16px",background:"#0a0a0a",border:"1px solid #1a1a1a",borderRadius:12,color:"#fff",fontSize:16,fontFamily:FF};
const BxS={background:"#0a0a0a",borderRadius:16,padding:18,marginBottom:14,border:"1px solid #131313"};
const CeS={background:"#0d0d0d",border:"1px solid #1a1a1a",borderRadius:8,color:"#fff",padding:"8px 2px",fontSize:14,textAlign:"center",fontFamily:"monospace",width:"100%"};
const BTS={width:"100%",padding:"14px",background:"#e8372c",borderRadius:12,color:"#fff",fontSize:14,fontWeight:700,cursor:"pointer",border:"none",marginTop:10};
const Chp=s=>({padding:"12px 18px",borderRadius:12,fontSize:14,fontWeight:600,cursor:"pointer",border:"none",background:s?"#e8372c":"#0d0d0d",color:s?"#fff":"#888"});
const Bx=({children,style})=> <div style={{...BxS,...style}}>{children}</div>;
const Hd=({children})=> <div style={{fontSize:10,fontWeight:700,color:"#3a3a3a",letterSpacing:1.5,textTransform:"uppercase",marginBottom:8}}>{children}</div>;
const Mn=({children,sz=28,c="#fff"})=> <span style={{fontFamily:"monospace",fontSize:sz,color:c}}>{children}</span>;
const RW=({l,v,c="#fff"})=> <div style={{display:"flex",justifyContent:"space-between",fontSize:12,marginBottom:3}}><span style={{color:"#3a3a3a"}}>{l}</span><span style={{fontFamily:"monospace",fontSize:12,color:c}}>{v}</span></div>;
const BM=({p,c})=> <div style={{height:3,background:"#141414",borderRadius:2,marginTop:2}}><div style={{height:"100%",borderRadius:2,background:c,width:`${Math.min(100,(p||0)*100)}%`}}/></div>;
const LS={fontSize:11,fontWeight:600,color:"#555",letterSpacing:1,textTransform:"uppercase",marginBottom:6,display:"block",marginTop:12};

export default function App(){
  const[prof,setProf]=useState(null);const[logs,setLogs]=useState({});const[loading,setLoading]=useState(true);const[scr,setScr]=useState("welcome");
  useEffect(()=>{(async()=>{if(!getToken()){setLoading(false);return;}try{const d=await getMe();setProf(d.user.profile);setLogs(d.logs||{});setScr("app");}catch(e){}setLoading(false);})();},[]);
  const sL=useCallback(fn=>{setLogs(p=>{const n=typeof fn==="function"?fn(p):fn;const today=ds();if(n[today])debouncedSaveLog(today,n[today]);return n;});},[]);
  const sP=useCallback(p=>{setProf(p);updateProfile(p);},[]);
  const login=async(u,pw)=>{try{const d=await apiLoginFn(u,pw);setProf(d.user.profile);setLogs(d.logs||{});setScr("app");return null;}catch(e){return e.message;}};
  const create=async(u,pw,p)=>{try{await apiSignup(u,pw,p.name,p);setProf(p);setLogs({});setScr("app");}catch(e){return e.message;}return null;};
  const logout=async()=>{apiLogoutFn();setProf(null);setLogs({});setScr("welcome");};
  if(loading) return <div style={{fontFamily:FF,background:"#000",color:"#fff",minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"}}><div style={{fontSize:14,fontWeight:800,letterSpacing:6,color:"#e8372c"}}>PRIME</div></div>;
  if(scr==="welcome") return <WL go={()=>setScr("onboard")} goLogin={()=>setScr("login")}/>;
  if(scr==="login") return <LG onLogin={login} back={()=>setScr("welcome")} goNew={()=>setScr("onboard")}/>;
  if(scr==="onboard") return <OB onCreate={create} back={()=>setScr("welcome")}/>;
  return <MA prof={prof} logs={logs} sL={sL} sP={sP} logout={logout}/>;
}

function WL({go,goLogin}){return <div style={{fontFamily:FF,background:"#000",color:"#fff",minHeight:"100vh",maxWidth:430,margin:"0 auto",padding:"0 28px",display:"flex",flexDirection:"column",justifyContent:"center"}}><div className="fu" style={{marginBottom:36}}><div style={{fontSize:14,fontWeight:800,letterSpacing:6,color:"#e8372c",marginBottom:20}}>PRIME</div><h1 style={{fontSize:34,fontWeight:800,lineHeight:1.1,marginBottom:14}}>Get back to<br/>your best self.</h1><p style={{fontSize:15,color:"#666",lineHeight:1.7}}>Track every calorie in and out ‚Äî including drinks ‚Äî and know exactly when you‚Äôll hit your goal.</p></div><div className="fu">{[{i:"üî¨",t:"Body composition analysis"},{i:"üìê",t:"100% personalized plan"},{i:"ü•É",t:"Alcohol accountability"},{i:"üìä",t:"End-of-day grades"}].map((x,i)=> <div key={i} style={{display:"flex",gap:12,marginBottom:14}}><div style={{fontSize:16,width:36,height:36,borderRadius:10,background:"#0d0d0d",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>{x.i}</div><div style={{fontSize:14,fontWeight:600,display:"flex",alignItems:"center"}}>{x.t}</div></div>)}</div><button onClick={go} style={{...BTS,fontSize:16,padding:16,borderRadius:14}}>Get Started</button><button onClick={goLogin} style={{...BTS,background:"#111",color:"#666",fontSize:14}}>I have an account</button></div>;}

function LG({onLogin,back,goNew}){const[n,sN]=useState("");const[pw,sPw]=useState("");const[err,sE]=useState("");const[ld,sLd]=useState(false);
  const go=async()=>{if(!n.trim()||!pw)return;sLd(true);sE("");const e=await onLogin(n.trim(),pw);if(e){sE(e);sLd(false);}};
  return <div style={{fontFamily:FF,background:"#000",color:"#fff",minHeight:"100vh",maxWidth:430,margin:"0 auto",padding:"0 28px",display:"flex",flexDirection:"column",justifyContent:"center"}}><button onClick={back} style={{position:"fixed",top:20,left:20,background:"none",border:"none",color:"#555",cursor:"pointer",fontFamily:FF,fontSize:14}}>‚Üê Back</button><div className="fu"><div style={{fontSize:14,fontWeight:800,letterSpacing:6,color:"#e8372c",marginBottom:20}}>PRIME</div><h2 style={{fontSize:24,fontWeight:700,marginBottom:20}}>Welcome back</h2><input value={n} onChange={e=>{sN(e.target.value);sE("")}} placeholder="Username" style={IS}/><input type="password" value={pw} onChange={e=>{sPw(e.target.value);sE("")}} placeholder="Password" onKeyDown={e=>e.key==="Enter"&&go()} style={{...IS,marginTop:10}}/>{err&&<div style={{color:"#e8372c",fontSize:13,marginTop:8}}>{err}</div>}<button onClick={go} disabled={ld} style={{...BTS,fontSize:16,padding:16,borderRadius:14}}>{ld?"...":"Log In"}</button><button onClick={goNew} style={{...BTS,background:"#111",color:"#666",fontSize:14}}>Create account</button></div></div>;}

function OB({onCreate,back}){const[st,sS]=useState(0);const[f,sF]=useState({un:"",name:"",pw:"",pw2:"",hF:"",hI:"",w:"",gw:"",age:"",sex:"",dl:"",drink:"",train:"",aiBfNow:null,aiBfGoal:null,aiGwSugg:null});const[azing,setAzing]=useState(null);const[pErr,setPErr]=useState("");const nRef=useRef(null);const gRef=useRef(null);const u=(k,v)=>sF(p=>({...p,[k]:v}));const hI=(+f.hF||0)*12+(+f.hI||0);
  const cBF=f.aiBfNow||(hI&&+f.w&&+f.age&&f.sex?estBF(+f.w,hI,+f.age,f.sex):0);
  const gBF=f.aiBfGoal||(hI&&+f.gw&&+f.age&&f.sex?estBF(+f.gw,hI,+f.age,f.sex):0);
  const tdee=hI?cTDEE(+f.w||150,hI,+f.age||25,f.sex||"male",f.train||"3-4x/week"):2000;const calT=tdee-500;const proT=Math.round((+f.w||150)*.9);const dL=f.dl?dB(ds(),f.dl):0;const gW=+f.gw||0;
  const cF=cBF?Math.round(+f.w*cBF/100):0;const cL=cBF?Math.round(+f.w*(1-cBF/100)):0;
  const gF=gBF&&gW?Math.round(gW*gBF/100):0;const gL=gBF&&gW?Math.round(gW*(1-gBF/100)):0;
  const fLoss=Math.max(0,cF-gF);const mG=gL-cL;
  const cC=cBF?bfL(cBF,f.sex):{l:"",c:"#fff"};const gC=gBF?bfL(gBF,f.sex):{l:"",c:"#fff"};
  const pwOk=validPw(f.pw);const pwM=f.pw===f.pw2;
  const handlePhoto=async(file,type)=>{if(!file)return;setPErr("");setAzing(type);try{const b64=await compressImage(file);const res=await fetch("/api/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:b64,weight:+f.w||150,height:hI||69,age:+f.age||25,sex:f.sex||"male",context:type==="now"?"current":"goal"})});const data=await res.json();if(data.error){setPErr(type.toUpperCase()+": "+data.error+(data.details?" ‚Äî "+data.details:""));}else{if(type==="now"){u("aiBfNow",data.bf);}else{u("aiBfGoal",data.bf);if(data.bf&&+f.w&&cBF){const lm=+f.w*(1-cBF/100);const sg=Math.round(lm/(1-data.bf/100));u("aiGwSugg",sg);}}}}catch(e){setPErr("Error: "+e.message);}setAzing(null);};
  const fin=()=>onCreate(f.un.trim(),f.pw,{name:f.name,hIn:hI,w:+f.w,gw:+f.gw,sw:+f.w,age:+f.age,sex:f.sex,dl:f.dl,drink:f.drink,train:f.train,sd:ds(),cBF,gBF,tdee,calT,proT,woDay:0});
  const ok=[f.un.trim()&&f.name.trim()&&pwOk&&pwM,f.hF&&f.w&&f.age&&f.sex,true,f.gw,f.dl,f.drink&&f.train,true];
  const H2={fontSize:26,fontWeight:800,marginBottom:6};const Sub={fontSize:14,color:"#555",lineHeight:1.6,marginBottom:20};
  return <div style={{fontFamily:FF,background:"#000",color:"#fff",minHeight:"100vh",maxWidth:430,margin:"0 auto",padding:"56px 24px 32px",display:"flex",flexDirection:"column"}}>{st>0&&<button onClick={()=>sS(st-1)} style={{position:"fixed",top:16,left:16,background:"none",border:"none",color:"#555",cursor:"pointer",fontFamily:FF,fontSize:14,zIndex:10}}>‚Üê Back</button>}<div style={{display:"flex",gap:5,marginBottom:28}}>{Array(7).fill(0).map((_,i)=> <div key={i} style={{flex:1,height:3,borderRadius:2,background:i<=st?"#e8372c":"#1a1a1a"}}/>)}</div><div style={{flex:1}}>
  {st===0&&<div className="fu"><h2 style={H2}>Create account</h2><p style={Sub}>Pick a username and password.</p><input value={f.un} onChange={e=>u("un",e.target.value.replace(/\s/g,""))} placeholder="Username" style={IS}/><input value={f.name} onChange={e=>u("name",e.target.value)} placeholder="First name" style={{...IS,marginTop:10}}/><input type="password" value={f.pw} onChange={e=>u("pw",e.target.value)} placeholder="Password" style={{...IS,marginTop:10}}/><div style={{fontSize:11,color:f.pw.length>0?(pwOk?"#30d158":"#e8372c"):"#333",marginTop:4}}>6+ chars, 1 uppercase{pwOk?" ‚úì":""}</div><input type="password" value={f.pw2} onChange={e=>u("pw2",e.target.value)} placeholder="Confirm password" style={{...IS,marginTop:10}}/>{f.pw2&&!pwM&&<div style={{fontSize:11,color:"#e8372c",marginTop:4}}>Doesn‚Äôt match</div>}</div>}
  {st===1&&<div className="fu"><h2 style={H2}>About you</h2><div style={{display:"flex",gap:10}}><div style={{flex:1}}><label style={LS}>Ft</label><input type="number" inputMode="numeric" value={f.hF} onChange={e=>u("hF",e.target.value)} placeholder="5" style={IS}/></div><div style={{flex:1}}><label style={LS}>In</label><input type="number" inputMode="numeric" value={f.hI} onChange={e=>u("hI",e.target.value)} placeholder="9" style={IS}/></div></div><label style={LS}>Weight</label><input type="number" inputMode="decimal" value={f.w} onChange={e=>u("w",e.target.value)} placeholder="152" style={IS}/><label style={LS}>Age</label><input type="number" inputMode="numeric" value={f.age} onChange={e=>u("age",e.target.value)} placeholder="26" style={IS}/><label style={LS}>Sex</label><div style={{display:"flex",gap:10,marginTop:4}}><button onClick={()=>u("sex","male")} style={Chp(f.sex==="male")}>Male</button><button onClick={()=>u("sex","female")} style={Chp(f.sex==="female")}>Female</button></div></div>}
  {st===2&&<div className="fu"><h2 style={H2}>Body Analysis</h2><p style={Sub}>Upload photos for AI body fat estimation. Optional.</p><div style={{marginBottom:18}}><div style={{fontSize:12,fontWeight:700,color:"#e8372c",marginBottom:8}}>üì∏ NOW ‚Äî Current photo</div><input ref={nRef} type="file" accept="image/*" style={{display:"none"}} onChange={e=>{if(e.target.files[0])handlePhoto(e.target.files[0],"now")}}/><button onClick={()=>nRef.current?.click()} disabled={azing==="now"} style={{...BTS,background:f.aiBfNow?"#30d158":"#1a1a1a",color:f.aiBfNow?"#fff":"#888",marginTop:0}}>{azing==="now"?"Analyzing...":f.aiBfNow?("‚úì AI: ~"+f.aiBfNow+"% body fat"):"Choose Photo"}</button>{f.aiBfNow&&<div style={{fontSize:11,color:"#30d158",marginTop:4}}>AI: {f.aiBfNow}% ‚Äî {bfL(f.aiBfNow,f.sex||"male").l}</div>}</div><div style={{marginBottom:14}}><div style={{fontSize:12,fontWeight:700,color:"#30d158",marginBottom:8}}>üéØ PRIME ‚Äî Goal physique</div><input ref={gRef} type="file" accept="image/*" style={{display:"none"}} onChange={e=>{if(e.target.files[0])handlePhoto(e.target.files[0],"goal")}}/><button onClick={()=>gRef.current?.click()} disabled={azing==="goal"} style={{...BTS,background:f.aiBfGoal?"#30d158":"#1a1a1a",color:f.aiBfGoal?"#fff":"#888",marginTop:0}}>{azing==="goal"?"Analyzing...":f.aiBfGoal?("‚úì AI: ~"+f.aiBfGoal+"% body fat"):"Choose Photo"}</button>{f.aiBfGoal&&<div style={{fontSize:11,color:"#30d158",marginTop:4}}>AI: {f.aiBfGoal}% ‚Äî {bfL(f.aiBfGoal,f.sex||"male").l}</div>}{f.aiGwSugg&&<div style={{fontSize:12,color:"#0a84ff",marginTop:6}}>üí° Suggested goal weight: <strong>{f.aiGwSugg} lbs</strong></div>}</div>{pErr&&<div style={{background:"#1a0a0a",border:"1px solid #e8372c40",borderRadius:10,padding:12,marginTop:8}}><div style={{fontSize:12,color:"#e8372c"}}>{pErr}</div></div>}{!f.aiBfNow&&!f.aiBfGoal&&+f.w&&hI>0&&<div style={{...BxS,padding:14,marginTop:8}}><div style={{fontSize:11,color:"#444"}}>Formula estimate: ~{estBF(+f.w,hI,+f.age||25,f.sex||"male")}%</div></div>}<div style={{fontSize:11,color:"#333",marginTop:12,textAlign:"center"}}>Skip if you don‚Äôt have photos</div></div>}
  {st===3&&<div className="fu"><h2 style={H2}>Goal Weight</h2>{f.aiGwSugg&&<div style={{...BxS,padding:14,borderColor:"#0a84ff30",marginBottom:14}}><div style={{fontSize:12,color:"#0a84ff"}}>üí° AI suggested <strong>{f.aiGwSugg} lbs</strong> from your PRIME photo. Adjust if needed.</div></div>}<label style={LS}>Goal weight</label><input type="number" inputMode="decimal" value={f.gw} onChange={e=>u("gw",e.target.value)} placeholder="140" style={IS}/>{+f.w&&+f.gw&&cBF>0&&<div style={{marginTop:18}}><div style={{display:"flex",gap:10,marginBottom:14}}><div style={{...BxS,flex:1,textAlign:"center",padding:14}}><div style={{fontSize:9,fontWeight:700,color:"#555"}}>NOW</div><div style={{fontSize:22,fontWeight:800}}>{f.w}</div><div style={{fontSize:14,fontWeight:700,color:cC.c}}>~{cBF}%</div><div style={{fontSize:9,color:"#333"}}>{cF}lb fat ¬∑ {cL}lb lean</div></div><div style={{display:"flex",alignItems:"center",color:"#333"}}>‚Üí</div><div style={{...BxS,flex:1,textAlign:"center",padding:14,borderColor:"#30d15830"}}><div style={{fontSize:9,fontWeight:700,color:"#30d158"}}>PRIME</div><div style={{fontSize:22,fontWeight:800}}>{f.gw}</div><div style={{fontSize:14,fontWeight:700,color:gC.c}}>~{gBF}%</div><div style={{fontSize:9,color:"#333"}}>{gF}lb fat ¬∑ {gL}lb lean</div></div></div><div style={{...BxS,padding:14}}><div style={{fontSize:13,color:"#999",lineHeight:1.8}}>{fLoss>0&&<>Drop <strong style={{color:"#e8372c"}}>~{fLoss}lbs fat</strong>. </>}{mG>0&&fLoss>0&&<>Build <strong style={{color:"#30d158"}}>~{mG}lbs lean</strong>. </>}</div></div></div>}</div>}
  {st===4&&<div className="fu"><h2 style={H2}>Deadline</h2><input type="date" value={f.dl} onChange={e=>u("dl",e.target.value)} style={{...IS,colorScheme:"dark"}}/>{f.dl&&dL>0&&+f.w&&+f.gw&&(()=>{const tc=Math.abs(+f.w-+f.gw),wk=dL/7,rt=tc/wk;return <div style={{...BxS,padding:14,marginTop:14}}><div style={{fontSize:13,color:"#999",lineHeight:1.8}}><strong style={{color:"#fff"}}>{dL}d</strong> ¬∑ <strong style={{color:"#e8372c"}}>{tc}lbs</strong> ¬∑ <strong>{rt.toFixed(1)}/wk</strong>{rt>2?<><br/><strong style={{color:"#e8372c"}}>üö® Too fast.</strong></>:rt>1.5?<><br/><strong style={{color:"#ffd60a"}}>‚ö†Ô∏è Aggressive.</strong></>:<><br/><strong style={{color:"#30d158"}}>‚úÖ Doable.</strong></>}</div></div>})()}</div>}
  {st===5&&<div className="fu"><h2 style={H2}>Lifestyle</h2><label style={{...LS,marginTop:0}}>Drinking?</label><div style={{display:"flex",flexWrap:"wrap",gap:8,marginBottom:16}}>{["Never","1x/week","2x/week","3+/week"].map(o=> <button key={o} onClick={()=>u("drink",o)} style={Chp(f.drink===o)}>{o}</button>)}</div><label style={LS}>Training?</label><div style={{display:"flex",flexWrap:"wrap",gap:8}}>{["Not training","1-2x/week","3-4x/week","5+/week"].map(o=> <button key={o} onClick={()=>u("train",o)} style={Chp(f.train===o)}>{o}</button>)}</div></div>}
  {st===6&&<div className="fu"><h2 style={H2}>Your plan</h2><p style={Sub}>Built for {f.name}.</p><div style={{...BxS,padding:16}}><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:14}}><div><div style={{fontSize:10,color:"#444"}}>Daily cals</div><div style={{fontSize:22,fontWeight:800}}>{calT}</div></div><div><div style={{fontSize:10,color:"#444"}}>Protein</div><div style={{fontSize:22,fontWeight:800}}>{proT}g</div></div><div><div style={{fontSize:10,color:"#444"}}>TDEE</div><div style={{fontSize:18,color:"#888"}}>{tdee}</div></div><div><div style={{fontSize:10,color:"#444"}}>Split</div><div style={{fontSize:14,color:"#888"}}>Push/Pull/Legs</div></div></div></div></div>}
  </div><button onClick={st<6?()=>sS(st+1):fin} disabled={!ok[st]} style={{...BTS,background:ok[st]?"#e8372c":"#1a1a1a",color:ok[st]?"#fff":"#333",fontSize:16,padding:16,borderRadius:14,marginTop:20}}>{st<6?"Continue":"Let‚Äôs Go"}</button></div>;}

function MA({prof,logs,sL,sP,logout}){const[tab,setTab]=useState("today");const[sum,setSum]=useState(null);const today=ds();const td=logs[today]||{};const setTd=useCallback(fn=>sL(p=>{const c=p[today]||{};return{...p,[today]:typeof fn==="function"?fn(c):fn};}),[today,sL]);const woDay=(prof.woDay||0)%7;const wo=SCH[woDay];const subWo=()=>sP({...prof,woDay:(prof.woDay||0)+1});
  const E=useMemo(()=>{const days=Object.keys(logs).sort();const t=td;let cw=prof.sw||150;for(let i=days.length-1;i>=0;i--){if(logs[days[i]]?.wAM){cw=logs[days[i]].wAM;break;}}let fCal=0,fP=0,fC=0,fF=0;["b","l","d","s"].forEach(k=>(t[k]||[]).forEach(x=>{fCal+=x.cal||0;fP+=x.p||0;fC+=x.c||0;fF+=x.f||0;}));let dCal=0;(t.dr||[]).forEach(x=>{dCal+=(x.cal||0)*(x.qty||1);});let wCal=0,vol=0;const bw=cw*.4536;(t.wo||[]).forEach(ex=>{if(ex.done){const ss=ex.log?.filter(s=>s.w&&s.r).length||ex.s||3;wCal+=Math.round((ex.met||4.5)*bw*ss*1.5/60);}(ex.log||[]).forEach(s=>{vol+=(+s.w||0)*(+s.r||0);});});(t.myEx||[]).forEach(ex=>{const ss=ex.sets?.filter(s=>s.w&&s.r).length||1;wCal+=Math.round(4.5*bw*ss*1.5/60);ex.sets?.forEach(s=>{vol+=(+s.w||0)*(+s.r||0);});});(t.cardio||[]).forEach(c=>{wCal+=Math.round((c.met||5)*bw*(c.mins||30)/60);});const tdee=prof.tdee||2000;const totalIn=fCal+dCal;const net=totalIn-(tdee+wCal);const calT=prof.calT||1500;const proT=prof.proT||135;const gw=prof.gw||140;const toLose=Math.max(0,cw-gw);let wN=[];for(let i=6;i>=0;i--){const dd=new Date();dd.setDate(dd.getDate()-i);const k=ds(dd);const dx=logs[k];if(dx){let fc=0;["b","l","d","s"].forEach(m=>(dx[m]||[]).forEach(x=>{fc+=x.cal||0}));let dc=0;(dx.dr||[]).forEach(x=>{dc+=(x.cal||0)*(x.qty||1)});let wc=0;(dx.wo||[]).forEach(ex=>{if(ex.done)wc+=Math.round((ex.met||4)*bw*3*1.5/60)});(dx.myEx||[]).forEach(ex=>{wc+=Math.round(4.5*bw*(ex.sets?.filter(s=>s.w&&s.r).length||1)*1.5/60)});(dx.cardio||[]).forEach(c=>{wc+=Math.round((c.met||5)*bw*(c.mins||30)/60)});wN.push((fc+dc)-(tdee+wc));}}const wAvg=wN.length?Math.round(wN.reduce((a,b)=>a+b,0)/wN.length):net;const wLR=wAvg<0?Math.abs(wAvg*7/3500):0;const wks=wLR>0?toLose/wLR:999;const proj=wLR>0?new Date(Date.now()+wks*7*864e5):null;const dl=prof.dl;const dLeft=dl?dB(today,dl):0;const onT=proj?proj<=new Date(dl+"T23:59:59"):false;const reqD=dLeft>0?Math.round(toLose*3500/dLeft):0;let junkCal=0;["b","l","d","s"].forEach(k=>(t[k]||[]).forEach(x=>{if(JUNK.has(x.name||x.n))junkCal+=x.cal||0;}));const cleanCal=fCal-junkCal;let netStreak=0;const sortedD=[...days].sort().reverse();for(const dk of sortedD){if(dk>=today)continue;const dx=logs[dk];if(!dx)break;let fc2=0;["b","l","d","s"].forEach(m=>(dx[m]||[]).forEach(x=>{fc2+=x.cal||0}));let dc2=0;(dx.dr||[]).forEach(x=>{dc2+=(x.cal||0)*(x.qty||1)});let wc2=0;(dx.wo||[]).forEach(ex=>{if(ex.done)wc2+=Math.round((ex.met||4)*bw*3*1.5/60)});(dx.myEx||[]).forEach(ex=>{wc2+=Math.round(4.5*bw*(ex.sets?.filter(s=>s.w&&s.r).length||1)*1.5/60)});(dx.cardio||[]).forEach(c2=>{wc2+=Math.round((c2.met||5)*bw*(c2.mins||30)/60)});const dayNet=(fc2+dc2)-(tdee+wc2);if(dayNet<=0)netStreak++;else break;}return{cw,gw,fCal,fP,fC,fF,dCal,wCal,tdee,totalIn,net,calT,proT,toLose,wLR,wks,proj,dLeft,onT,reqD,vol,junkCal,cleanCal,netStreak};},[logs,today,prof,td]);
  const closeDay=()=>{const g=E.net<=-400?"A":E.net<=-200?"B":E.net<=0?"C":E.net<=300?"D":"F";setSum({net:E.net,fCal:E.fCal,dCal:E.dCal,wCal:E.wCal,fP:E.fP,g,m:g==="A"?"Crushed it.":g==="B"?"Solid.":g==="C"?"Break even.":g==="D"?"Over budget.":"Lock in tomorrow."});setTd(p=>({...p,closed:true}));};
  const tabs=[{id:"today",l:"Today"},{id:"train",l:"Train"},{id:"eat",l:"Eat"},{id:"drinks",l:"Drinks"},{id:"stats",l:"Stats"},{id:"close",l:"Close"}];
  if(sum) return <div style={{fontFamily:FF,background:"#000",color:"#fff",minHeight:"100vh",maxWidth:430,margin:"0 auto",padding:"0 24px",display:"flex",flexDirection:"column",justifyContent:"center"}}><div className="fu" style={{textAlign:"center",marginBottom:24}}><div style={{fontSize:48,marginBottom:8}}>{sum.g==="A"?"üî•":sum.g==="B"?"üí™":"üòê"}</div><div style={{fontSize:48,fontWeight:800,color:sum.net<0?"#30d158":"#e8372c"}}>{sum.g}</div><div style={{fontSize:15,color:"#888",marginTop:8}}>{sum.m}</div></div><Bx><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:14}}><div><div style={{fontSize:10,color:"#444"}}>Food</div><div style={{fontSize:18,fontWeight:700}}>{sum.fCal}</div></div><div><div style={{fontSize:10,color:"#444"}}>Alcohol</div><div style={{fontSize:18,fontWeight:700,color:sum.dCal?"#ffd60a":"#30d158"}}>{sum.dCal}</div></div><div><div style={{fontSize:10,color:"#444"}}>Burned</div><div style={{fontSize:18,fontWeight:700,color:"#ff9f0a"}}>{sum.wCal}</div></div><div><div style={{fontSize:10,color:"#444"}}>Protein</div><div style={{fontSize:18,fontWeight:700}}>{sum.fP}g</div></div></div></Bx><Bx style={{textAlign:"center"}}><div style={{fontSize:36,fontWeight:800,fontFamily:"monospace",color:sum.net<0?"#30d158":"#e8372c"}}>{sum.net>0?"+":""}{sum.net}</div></Bx><button onClick={()=>setSum(null)} style={{...BTS,fontSize:16,padding:16,borderRadius:14}}>Done</button></div>;
  return <div style={{fontFamily:FF,background:"#000",color:"#fff",minHeight:"100vh",maxWidth:430,margin:"0 auto",paddingBottom:80}}><div style={{padding:"14px 20px 10px",position:"sticky",top:0,zIndex:10,background:"rgba(0,0,0,.94)",backdropFilter:"blur(16px)"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><span style={{fontSize:11,fontWeight:800,letterSpacing:5,color:"#e8372c"}}>PRIME</span><div style={{fontSize:12,color:"#444",marginTop:1}}>{prof.name}</div></div><div style={{display:"flex",alignItems:"center",gap:14}}><div style={{textAlign:"right"}}><span style={{fontSize:28,fontWeight:300,fontFamily:"monospace",color:E.dLeft<=14?"#e8372c":"#fff"}}>{Math.max(0,E.dLeft)}</span><span style={{fontSize:10,color:"#444",marginLeft:3}}>days</span></div><button onClick={()=>setTab(tab==="settings"?"today":"settings")} style={{width:32,height:32,borderRadius:10,background:tab==="settings"?"#1a1a1a":"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,color:tab==="settings"?"#fff":"#444"}}>‚öô</button></div></div><div style={{marginTop:8,height:3,background:"#111",borderRadius:2}}><div style={{height:"100%",borderRadius:2,width:`${Math.min(100,Math.max(1,((prof.sw-E.cw)/(prof.sw-E.gw))*100))}%`,background:"linear-gradient(90deg,#e8372c,#ff9500)"}}/></div></div>
    <div key={tab} className="fu" style={{padding:"8px 20px 0"}}>{tab==="today"&&<TT E={E} wo={wo} go={setTab} prof={prof} logs={logs} woDay={woDay}/>}{tab==="train"&&<TR E={E} wo={wo} td={td} set={setTd} cw={E.cw} sub={subWo} wd={prof.woDay}/>}{tab==="eat"&&<ET E={E} td={td} set={setTd}/>}{tab==="drinks"&&<DT E={E} td={td} set={setTd}/>}{tab==="stats"&&<ST E={E} prof={prof} logs={logs}/>}{tab==="settings"&&<SE prof={prof} logout={logout}/>}{tab==="close"&&<CT E={E} td={td} set={setTd} close={closeDay}/>}</div>
    <div style={{position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)",width:"100%",maxWidth:430,background:"rgba(0,0,0,.95)",backdropFilter:"blur(20px)",borderTop:"1px solid #111",display:"flex",padding:"8px 0 calc(8px + env(safe-area-inset-bottom))",zIndex:20}}>{tabs.map(t=> <button key={t.id} onClick={()=>setTab(t.id)} style={{flex:1,background:"none",border:"none",cursor:"pointer",padding:"6px 0",display:"flex",flexDirection:"column",alignItems:"center",gap:4}}><div style={{width:5,height:5,borderRadius:3,background:tab===t.id?"#e8372c":"transparent"}}/><span style={{fontSize:9,fontWeight:tab===t.id?700:500,color:tab===t.id?(t.id==="close"?"#30d158":"#e8372c"):"#444"}}>{t.l}</span></button>)}</div></div>;}

function TT({E,wo,go,prof,logs,woDay}){
  const today=new Date();const todayDow=(today.getDay()+6)%7;
  const weekDays=[];for(let i=0;i<7;i++){const d=new Date(today);d.setDate(today.getDate()-(todayDow-i));const k=ds(d);const schOff=i-todayDow;const schIdx=(((woDay||0)+schOff)%7+7)%7;const sch=SCH[schIdx];const done=logs[k]?.closed||false;weekDays.push({d:d.getDate(),l:["M","T","W","T","F","S","S"][i],wo:sch,today:i===todayDow,done,k});}
  const R=52,C=2*Math.PI*R;const budget=E.calT||1500;
  const cleanPct=Math.min(1,(E.cleanCal||0)/budget);const junkPct=Math.min(1-cleanPct,(E.junkCal||0)/budget);const alcPct=Math.min(1-cleanPct-junkPct,(E.dCal||0)/budget);
  const cleanLen=cleanPct*C;const junkLen=junkPct*C;const alcLen=alcPct*C;
  const burnR=40,burnC=2*Math.PI*burnR;const burnPct=Math.min(1,(E.wCal||0)/300);
  const dots=[];for(let i=6;i>=0;i--){const d2=new Date();d2.setDate(d2.getDate()-i);const k2=ds(d2);if(k2===ds()){dots.push("today");}else if(logs[k2]){const dx=logs[k2];let fc=0;["b","l","d","s"].forEach(m=>(dx[m]||[]).forEach(x=>{fc+=x.cal||0}));let dc=0;(dx.dr||[]).forEach(x=>{dc+=(x.cal||0)*(x.qty||1)});let wc=0;const bw=(E.cw||150)*.4536;(dx.wo||[]).forEach(ex=>{if(ex.done)wc+=Math.round((ex.met||4)*bw*3*1.5/60)});(dx.cardio||[]).forEach(c=>{wc+=Math.round((c.met||5)*bw*(c.mins||30)/60)});dots.push((fc+dc)-((E.tdee||2000)+wc)<=0?"on":"fail");}else{dots.push("empty");}}
  const exercises=wo!=="Rest"?WO[wo]||[]:[];
  const Cd=({children,style})=><div style={{background:"#080808",border:"1px solid #111",borderRadius:18,padding:18,...style}}>{children}</div>;
  return <div>
    <div style={{display:"flex",gap:3,marginBottom:16}}>{weekDays.map((wd,i)=><div key={i} onClick={()=>go("train")} style={{flex:1,textAlign:"center",padding:"8px 0",borderRadius:12,cursor:"pointer",background:wd.today?"#e8372c":"transparent",boxShadow:wd.today?"0 2px 12px rgba(232,55,44,.25)":"none",position:"relative"}}>
      <div style={{fontSize:9,fontWeight:700,color:wd.today?"rgba(255,255,255,.6)":"#333",letterSpacing:.5}}>{wd.l}</div>
      <div style={{fontSize:14,fontWeight:700,color:wd.today?"#fff":wd.done?"#30d158":"#444",margin:"2px 0 1px"}}>{wd.d}</div>
      <div style={{fontSize:7,fontWeight:700,color:wd.today?"rgba(255,255,255,.8)":wd.wo==="Rest"?"#1a1a1a":"#e8372c",letterSpacing:.3,textTransform:"uppercase"}}>{wd.wo}</div>
      {wd.done&&!wd.today&&<div style={{position:"absolute",bottom:3,left:"50%",transform:"translateX(-50%)",width:4,height:4,borderRadius:2,background:"#30d158"}}/>}
    </div>)}</div>
    <Cd style={{display:"flex",alignItems:"center",gap:18,marginBottom:14}}>
      <div style={{position:"relative",width:130,height:130,flexShrink:0}}>
        <svg width={130} height={130} style={{transform:"rotate(-90deg)"}}>
          <circle cx={65} cy={65} r={R} fill="none" stroke="#111" strokeWidth={10}/>
          {cleanLen>0&&<circle cx={65} cy={65} r={R} fill="none" stroke="#30d158" strokeWidth={10} strokeDasharray={`${cleanLen} ${C-cleanLen}`} strokeLinecap="round" style={{filter:"drop-shadow(0 0 4px rgba(48,209,88,.25))"}}/>}
          {junkLen>0&&<circle cx={65} cy={65} r={R} fill="none" stroke="#ff9f0a" strokeWidth={10} strokeDasharray={`${junkLen} ${C-junkLen}`} strokeDashoffset={-cleanLen} strokeLinecap="round" style={{filter:"drop-shadow(0 0 4px rgba(255,159,10,.2))"}}/>}
          {alcLen>0&&<circle cx={65} cy={65} r={R} fill="none" stroke="#ffd60a" strokeWidth={10} strokeDasharray={`${alcLen} ${C-alcLen}`} strokeDashoffset={-(cleanLen+junkLen)} strokeLinecap="round"/>}
          <circle cx={65} cy={65} r={burnR} fill="none" stroke="#111" strokeWidth={6}/>
          <circle cx={65} cy={65} r={burnR} fill="none" stroke="#e8372c" strokeWidth={6} strokeDasharray={`${burnPct*burnC} ${burnC-burnPct*burnC}`} strokeLinecap="round" style={{filter:"drop-shadow(0 0 4px rgba(232,55,44,.2))"}}/>
        </svg>
        <div style={{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}}>
          <span style={{fontFamily:"monospace",fontSize:24,fontWeight:700,color:E.net<0?"#30d158":E.net>300?"#e8372c":"#ffd60a"}}>{E.net>0?"+":""}{E.net}</span>
          <span style={{fontSize:8,color:"#444",fontWeight:600,letterSpacing:1,textTransform:"uppercase"}}>Net</span>
        </div>
      </div>
      <div style={{flex:1,display:"flex",flexDirection:"column",gap:5}}>
        {[{dot:"#30d158",n:"Clean food",v:E.cleanCal||0,c:"#30d158"},{dot:"#ff9f0a",n:"Junk",v:E.junkCal||0,c:"#ff9f0a"},{dot:"#ffd60a",n:"Alcohol",v:E.dCal||0,c:E.dCal?"#ffd60a":"#222"}].map((x,i)=><div key={i} style={{display:"flex",alignItems:"center",gap:8}}>
          <div style={{width:8,height:8,borderRadius:4,background:x.dot,flexShrink:0}}/>
          <div style={{flex:1,display:"flex",justifyContent:"space-between"}}><span style={{fontSize:11,color:"#666"}}>{x.n}</span><span style={{fontFamily:"monospace",fontSize:13,fontWeight:700,color:x.c}}>{x.v}</span></div>
        </div>)}
        <div style={{height:1,background:"#111",margin:"2px 0"}}/>
        <div style={{display:"flex",alignItems:"center",gap:8}}><div style={{width:8,height:8,borderRadius:4,background:"#e8372c",flexShrink:0}}/><div style={{flex:1,display:"flex",justifyContent:"space-between"}}><span style={{fontSize:11,color:"#666"}}>Burned</span><span style={{fontFamily:"monospace",fontSize:13,fontWeight:700,color:"#e8372c"}}>{E.wCal}</span></div></div>
        <div style={{height:1,background:"#111",margin:"2px 0"}}/>
        <div style={{display:"flex",alignItems:"center",gap:8}}><div style={{width:7,height:7,borderRadius:4,border:"1px solid #333",flexShrink:0}}/><div style={{flex:1,display:"flex",justifyContent:"space-between"}}><span style={{fontSize:11,color:"#666"}}>Budget left</span><span style={{fontFamily:"monospace",fontSize:13,fontWeight:700,color:"#444"}}>{Math.max(0,budget-E.totalIn)}</span></div></div>
      </div>
    </Cd>
    <div style={{display:"flex",gap:6,marginBottom:14}}>
      {[{l:"Protein",v:E.fP+"g",p:E.fP/E.proT,c:"#ff9f0a"},{l:"Carbs",v:E.fC+"g",p:.55,c:"#0a84ff"},{l:"Fat",v:E.fF+"g",p:.35,c:"#ffd60a"}].map((x,i)=><div key={i} style={{flex:1,background:"#080808",border:"1px solid #111",borderRadius:12,padding:"10px 8px",textAlign:"center"}}>
        <div style={{fontSize:7,fontWeight:700,color:"#222",letterSpacing:1.5,textTransform:"uppercase"}}>{x.l}</div>
        <div style={{fontFamily:"monospace",fontSize:15,fontWeight:700,color:x.c,marginTop:3}}>{x.v}</div>
        <div style={{height:2,background:"#111",borderRadius:1,marginTop:6,overflow:"hidden"}}><div style={{height:"100%",borderRadius:1,background:x.c,width:`${Math.min(100,x.p*100)}%`}}/></div>
      </div>)}
    </div>
    <Cd style={{marginBottom:14,padding:0,overflow:"hidden"}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"14px 16px",borderBottom:"1px solid #0d0d0d"}}>
        <span style={{fontSize:15,fontWeight:700}}>{wo==="Rest"?"Rest Day":wo+" Day"}</span>
        <span onClick={()=>go("train")} style={{fontSize:10,fontWeight:700,color:"#e8372c",background:"rgba(232,55,44,.08)",padding:"5px 12px",borderRadius:16,cursor:"pointer"}}>{wo==="Rest"?"Off":"Start ‚Üí"}</span>
      </div>
      {exercises.slice(0,6).map((ex,i)=><div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 16px",borderBottom:i<5?"1px solid #080808":"none"}}>
        <div style={{display:"flex",alignItems:"center",gap:10}}>
          <div style={{width:20,height:20,borderRadius:6,background:"#0d0d0d",border:"1px solid #1a1a1a",display:"flex",alignItems:"center",justifyContent:"center",fontSize:9,fontWeight:700,color:"#333",fontFamily:"monospace"}}>{i+1}</div>
          <div><div style={{fontSize:13,fontWeight:600}}>{ex.n}</div><div style={{fontSize:10,color:"#333"}}>{ex.s} {"√ó"} {ex.r}</div></div>
        </div>
        <div style={{fontSize:8,fontWeight:700,color:"rgba(232,55,44,.5)",letterSpacing:.5,textTransform:"uppercase"}}>{ex.m}</div>
      </div>)}
    </Cd>
    <Cd style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"14px 18px",marginBottom:14,background:"linear-gradient(135deg,#0a0800,#080808)",borderColor:"rgba(255,159,10,.1)"}}>
      <div style={{display:"flex",alignItems:"center",gap:12}}>
        <span style={{fontSize:24}}>{"üî•"}</span>
        <div>
          <div style={{display:"flex",alignItems:"baseline",gap:6}}>
            <span style={{fontFamily:"monospace",fontSize:28,fontWeight:700,color:"#ff9f0a"}}>{E.netStreak||0}</span>
            <span style={{fontSize:11,fontWeight:700,color:"#ff9f0a",letterSpacing:1,textTransform:"uppercase"}}>Net Streak</span>
          </div>
          <div style={{fontSize:10,color:"#333"}}>{E.netStreak||0} consecutive days net negative</div>
        </div>
      </div>
      <div style={{display:"flex",gap:4}}>{dots.map((d,i)=><div key={i} style={{width:8,height:8,borderRadius:4,border:d==="empty"?"1px solid #222":"none",background:d==="on"?"#30d158":d==="fail"?"#e8372c":d==="today"?"#444":"transparent",boxShadow:d==="on"?"0 0 6px rgba(48,209,88,.3)":"none"}}/>)}</div>
    </Cd>
    <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:6}}>
      {[{l:"Arrival",v:E.proj?E.proj.toLocaleDateString("en-US",{month:"short",day:"numeric"}):"‚Äî",c:E.onT?"#30d158":"#e8372c"},{l:"Rate",v:E.wLR.toFixed(1),c:"#fff"},{l:"To Lose",v:E.toLose.toFixed(1),c:"#e8372c"},{l:"On Track",v:E.onT?"Yes":"No",c:E.onT?"#30d158":"#e8372c"}].map((x,i)=><div key={i} style={{background:"#080808",border:"1px solid #111",borderRadius:14,padding:"12px 8px",textAlign:"center"}}>
        <div style={{fontSize:7,fontWeight:700,color:"#222",letterSpacing:1.5,textTransform:"uppercase"}}>{x.l}</div>
        <div style={{fontFamily:"monospace",fontSize:16,fontWeight:700,color:x.c,marginTop:4}}>{x.v}</div>
      </div>)}
    </div>
  </div>;}

function TR({E,wo,td,set,cw,sub,wd}){const ps=td.wo||(wo!=="Rest"?WO[wo].map(e=>({...e,done:false,log:Array.from({length:e.s},()=>({w:"",r:""}))})):[]);const my=td.myEx||[];const ca=td.cardio||[];const[aE,sAE]=useState(false);const[eN,sEN]=useState("");const[eS,sES]=useState("3");const[aC,sAC]=useState(false);const[cT,sCT]=useState("");const[cM,sCM]=useState("");const[sb,sSB]=useState(td.woSub||false);
  const uP=n=>set(p=>({...p,wo:n}));const tog=i=>{const n=[...ps];n[i]={...n[i],done:!n[i].done};uP(n);};const sLog=(ei,si,f,v)=>{const n=[...ps];n[ei]={...n[ei],log:[...n[ei].log]};n[ei].log[si]={...n[ei].log[si],[f]:v===""?"":+v};uP(n);};
  const addE=()=>{if(!eN.trim())return;set(p=>({...p,myEx:[...(p.myEx||[]),{name:eN,sets:Array.from({length:+eS||3},()=>({w:"",r:""}))}]}));sEN("");sES("3");sAE(false);};const sML=(ei,si,f,v)=>set(p=>{const ex=[...(p.myEx||[])];ex[ei]={...ex[ei],sets:[...ex[ei].sets]};ex[ei].sets[si]={...ex[ei].sets[si],[f]:v===""?"":+v};return{...p,myEx:ex};});const rmE=i=>set(p=>({...p,myEx:(p.myEx||[]).filter((_,j)=>j!==i)}));
  const addC=()=>{if(!cT||!cM)return;const met=CM[cT]||5;set(p=>({...p,cardio:[...(p.cardio||[]),{type:cT,mins:+cM,met,cal:Math.round(met*(cw*.4536)*(+cM)/60)}]}));sCT("");sCM("");sAC(false);};const rmC=i=>set(p=>({...p,cardio:(p.cardio||[]).filter((_,j)=>j!==i)}));
  const doS=()=>{set(p=>({...p,woSub:true}));sSB(true);sub();};
  return <div><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}}><div style={{fontSize:20,fontWeight:700}}>{wo==="Rest"?"Rest Day":wo+" Day"}</div><div style={{display:"flex",gap:14}}><div style={{textAlign:"center"}}><Mn sz={14} c="#bf5af2">{E.vol.toLocaleString()}</Mn><div style={{fontSize:8,color:"#333"}}>vol</div></div><div style={{textAlign:"center"}}><Mn sz={14} c="#ff9f0a">{E.wCal}</Mn><div style={{fontSize:8,color:"#333"}}>cal</div></div></div></div>
    {wo!=="Rest"&&ps.map((ex,ei)=> <Bx key={ei} style={{borderColor:ex.done?"#30d15830":"#131313"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}><div><div style={{fontSize:14,fontWeight:600,color:ex.done?"#30d158":"#fff"}}>{ex.n}</div><div style={{fontSize:10,color:"#333"}}>{ex.m} ¬∑ {ex.s}√ó{ex.r}</div></div><button onClick={()=>tog(ei)} style={{width:32,height:32,borderRadius:10,border:ex.done?"none":"2px solid #222",background:ex.done?"#30d158":"transparent",cursor:"pointer",color:"#fff",fontSize:14,display:"flex",alignItems:"center",justifyContent:"center"}}>{ex.done?"‚úì":""}</button></div><div style={{display:"grid",gridTemplateColumns:`28px repeat(${ex.s},1fr)`,gap:4,alignItems:"center"}}><div/>{Array.from({length:ex.s},(_,i)=> <div key={i} style={{textAlign:"center",fontSize:8,color:"#2a2a2a",fontWeight:700}}>S{i+1}</div>)}<div style={{fontSize:8,color:"#2a2a2a",fontWeight:700}}>LB</div>{ex.log.map((s,si)=> <input key={`w${si}`} type="number" inputMode="numeric" value={s.w} onChange={e=>sLog(ei,si,"w",e.target.value)} style={CeS}/>)}<div style={{fontSize:8,color:"#2a2a2a",fontWeight:700}}>RP</div>{ex.log.map((s,si)=> <input key={`r${si}`} type="number" inputMode="numeric" value={s.r} onChange={e=>sLog(ei,si,"r",e.target.value)} style={CeS}/>)}</div></Bx>)}
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:8,marginBottom:10}}><div style={{fontSize:14,fontWeight:700}}>My Exercises</div><button onClick={()=>sAE(!aE)} style={{width:28,height:28,borderRadius:8,background:"#0a84ff",border:"none",color:"#fff",fontSize:18,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>+</button></div>
    {aE&&<Bx><input value={eN} onChange={e=>sEN(e.target.value)} placeholder="Exercise name" style={{...IS,fontSize:14,padding:"12px",marginBottom:8}}/><div style={{display:"flex",gap:8,alignItems:"center"}}><span style={{fontSize:12,color:"#444"}}>Sets:</span><input type="number" inputMode="numeric" value={eS} onChange={e=>sES(e.target.value)} style={{...CeS,width:48,padding:8}}/></div><button onClick={addE} style={{...BTS,background:"#0a84ff"}}>Add</button></Bx>}
    {my.map((ex,ei)=> <Bx key={ei} style={{borderColor:"#0a84ff30"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}><div style={{fontSize:14,fontWeight:600,color:"#0a84ff"}}>{ex.name}</div><button onClick={()=>rmE(ei)} style={{background:"none",border:"none",color:"#222",cursor:"pointer",fontSize:16}}>√ó</button></div><div style={{display:"grid",gridTemplateColumns:`28px repeat(${ex.sets.length},1fr)`,gap:4,alignItems:"center"}}><div/>{ex.sets.map((_,i)=> <div key={i} style={{textAlign:"center",fontSize:8,color:"#2a2a2a",fontWeight:700}}>S{i+1}</div>)}<div style={{fontSize:8,color:"#2a2a2a",fontWeight:700}}>LB</div>{ex.sets.map((s,si)=> <input key={`w${si}`} type="number" inputMode="numeric" value={s.w} onChange={e=>sML(ei,si,"w",e.target.value)} style={CeS}/>)}<div style={{fontSize:8,color:"#2a2a2a",fontWeight:700}}>RP</div>{ex.sets.map((s,si)=> <input key={`r${si}`} type="number" inputMode="numeric" value={s.r} onChange={e=>sML(ei,si,"r",e.target.value)} style={CeS}/>)}</div></Bx>)}
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:8,marginBottom:10}}><div style={{fontSize:14,fontWeight:700}}>Cardio</div><button onClick={()=>sAC(!aC)} style={{width:28,height:28,borderRadius:8,background:"#ff9f0a",border:"none",color:"#fff",fontSize:18,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>+</button></div>
    {aC&&<Bx><select value={cT} onChange={e=>sCT(e.target.value)} style={{...IS,fontSize:14,padding:"12px",marginBottom:8}}><option value="">Activity...</option>{Object.keys(CM).map(k=> <option key={k} value={k}>{k}</option>)}</select>{cT&&<><input type="number" inputMode="numeric" value={cM} onChange={e=>sCM(e.target.value)} placeholder="Minutes" style={{...IS,fontSize:14,padding:"12px"}}/>{cM&&<div style={{fontSize:12,color:"#888",marginTop:6}}>‚âà {Math.round((CM[cT]||5)*(cw*.4536)*(+cM)/60)} cal</div>}<button onClick={addC} style={{...BTS,background:"#ff9f0a"}}>Add</button></>}</Bx>}
    {ca.map((c,i)=> <Bx key={i} style={{borderColor:"#ff9f0a30"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{fontSize:14}}>{c.type}</div><div style={{fontSize:11,color:"#444"}}>{c.mins}min</div></div><div style={{display:"flex",alignItems:"center",gap:8}}><Mn sz={14} c="#ff9f0a">{c.cal}</Mn><button onClick={()=>rmC(i)} style={{background:"none",border:"none",color:"#222",cursor:"pointer",fontSize:16}}>√ó</button></div></div></Bx>)}
    {!sb&&<button onClick={doS} style={{...BTS,background:"#30d158",marginTop:16,fontSize:16,padding:16,borderRadius:14}}>Submit Workout ‚úì</button>}
    {sb&&<div style={{textAlign:"center",color:"#30d158",fontSize:14,fontWeight:600,marginTop:16}}>Submitted ‚úì ¬∑ Next: {SCH[((wd||0)+1)%7]}</div>}</div>;}

function ET({E,td,set}){const cm=mbt();const ms=[{k:"b",l:"Breakfast"},{k:"l",l:"Lunch"},{k:"s",l:"Snack"},{k:"d",l:"Dinner"}];const[op,sOp]=useState(null);const[q,sQ]=useState("");const[res,sRes]=useState([]);const[mode,sMode]=useState("search");const[cu,sCu]=useState({n:"",cal:"",p:"",c:"",f:""});
  const srch=v=>{sQ(v);sRes(sF(v));};const add=(mk,it)=>{set(p=>({...p,[mk]:[...(p[mk]||[]),{...it,time:new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}]}));sQ("");sRes([]);sCu({n:"",cal:"",p:"",c:"",f:""});sOp(null);};const rm=(mk,i)=>set(p=>({...p,[mk]:(p[mk]||[]).filter((_,j)=>j!==i)}));
  return <div><Bx style={{display:"flex",justifyContent:"space-around",padding:"14px 8px"}}>{[{l:"Cals",v:E.fCal,c:E.fCal>E.calT?"#e8372c":"#30d158"},{l:"Pro",v:E.fP+"g",c:E.fP>=E.proT?"#30d158":"#fff"},{l:"Carb",v:E.fC+"g",c:"#0a84ff"},{l:"Fat",v:E.fF+"g",c:"#ff9f0a"}].map((x,i)=> <div key={i} style={{textAlign:"center"}}><div style={{fontSize:9,color:"#2a2a2a"}}>{x.l}</div><Mn sz={16} c={x.c}>{x.v}</Mn></div>)}</Bx>
    {ms.map(meal=>{const items=td[meal.k]||[];const mc=items.reduce((a,x)=>a+(x.cal||0),0);const cur=meal.k===cm;return <Bx key={meal.k} style={{borderColor:cur?"#e8372c20":"#131313"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><span style={{fontSize:16,fontWeight:700}}>{meal.l}{cur&&<span style={{fontSize:10,color:"#e8372c",marginLeft:6}}>‚óè now</span>}</span><div style={{display:"flex",alignItems:"center",gap:8}}><Mn sz={13} c="#3a3a3a">{mc}</Mn><button onClick={()=>{sOp(op===meal.k?null:meal.k);sMode("search");sQ("");sRes([])}} style={{width:28,height:28,borderRadius:8,background:"#e8372c",border:"none",color:"#fff",fontSize:18,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>+</button></div></div>
      {items.map((it,i)=> <div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderTop:"1px solid #111",...(i===0?{marginTop:10}:{})}}><div><div style={{fontSize:13}}>{it.name||it.n}</div><div style={{fontSize:10,color:"#2a2a2a"}}>P:{it.p} C:{it.c} F:{it.f}{it.time?" ¬∑ "+it.time:""}</div></div><div style={{display:"flex",alignItems:"center",gap:8}}><Mn sz={12} c="#444">{it.cal}</Mn><button onClick={()=>rm(meal.k,i)} style={{background:"none",border:"none",color:"#222",cursor:"pointer",fontSize:16}}>√ó</button></div></div>)}
      {op===meal.k&&<div style={{marginTop:12,padding:14,background:"#060606",borderRadius:12,border:"1px solid #141414"}}><div style={{display:"flex",gap:6,marginBottom:10}}><button onClick={()=>sMode("search")} style={Chp(mode==="search")}>Search</button><button onClick={()=>sMode("custom")} style={Chp(mode==="custom")}>Custom</button></div>
        {mode==="search"&&<><input value={q} onChange={e=>srch(e.target.value)} placeholder="chicken, doritos..." style={{...IS,fontSize:14,padding:"12px"}}/>{res.length>0&&<div style={{marginTop:8}}>{res.map((r,i)=> <div key={i} onClick={()=>add(meal.k,{name:r.n,cal:r.cal,p:r.p,c:r.c,f:r.f})} style={{padding:"10px 0",borderTop:i?"1px solid #111":"none",cursor:"pointer",display:"flex",justifyContent:"space-between"}}><span style={{fontSize:13,color:"#ccc"}}>{r.n}</span><span style={{fontSize:11,fontFamily:"monospace",color:"#666"}}>{r.cal} ¬∑ {r.p}p</span></div>)}</div>}{q.length>1&&!res.length&&<div style={{fontSize:12,color:"#444",marginTop:8}}>No match ‚Äî try custom</div>}</>}
        {mode==="custom"&&<><input value={cu.n} onChange={e=>sCu(p=>({...p,n:e.target.value}))} placeholder="Food name" style={{...IS,fontSize:14,padding:"12px",marginBottom:8}}/><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:7}}>{[["cal","Calories"],["p","Protein"],["c","Carbs"],["f","Fat"]].map(([k,ph])=> <input key={k} type="number" inputMode="numeric" value={cu[k]} onChange={e=>sCu(p=>({...p,[k]:e.target.value}))} placeholder={ph} style={{...CeS,padding:"10px 12px",fontSize:14,width:"100%"}}/>)}</div><button onClick={()=>{if(cu.n)add(meal.k,{name:cu.n,cal:+cu.cal||0,p:+cu.p||0,c:+cu.c||0,f:+cu.f||0})}} style={BTS}>Add</button></>}
      </div>}</Bx>;})}
    {hr()>=21&&<Bx style={{borderColor:"#ffd60a20"}}><div style={{fontSize:12,color:"#ffd60a",fontWeight:700}}>‚ö†Ô∏è Late night eating = more fat stored</div></Bx>}</div>;}

function DT({E,td,set}){const[sel,sSel]=useState("");const[qty,sQty]=useState("1");const dr=td.dr||[];const tot=dr.reduce((a,d)=>a+(d.cal||0)*(d.qty||1),0);
  const add=()=>{if(!sel||!ALC[sel])return;set(p=>({...p,dr:[...(p.dr||[]),{name:sel,cal:ALC[sel],qty:+qty||1}]}));sSel("");sQty("1");};const rm=i=>set(p=>({...p,dr:(p.dr||[]).filter((_,j)=>j!==i)}));
  return <div><Bx style={{display:"flex",justifyContent:"space-around",alignItems:"center",padding:20}}><div style={{textAlign:"center"}}><Mn sz={30} c={tot?"#ffd60a":"#30d158"}>{tot}</Mn><div style={{fontSize:11,color:"#444",marginTop:2}}>drink cals</div></div><div style={{width:1,height:32,background:"#1a1a1a"}}/><div style={{textAlign:"center"}}><Mn sz={30} c="#e8372c">{(tot/500).toFixed(1)}</Mn><div style={{fontSize:11,color:"#444",marginTop:2}}>days erased</div></div></Bx>
    <Bx><Hd>Log</Hd><select value={sel} onChange={e=>sSel(e.target.value)} style={{...IS,fontSize:14,padding:"12px"}}><option value="">Drink?</option>{Object.keys(ALC).map(k=> <option key={k} value={k}>{k} ({ALC[k]})</option>)}</select>{sel&&<div style={{marginTop:12}}><div style={{display:"flex",gap:10,alignItems:"center"}}><span style={{fontSize:13,color:"#444"}}>Qty:</span><input type="number" inputMode="numeric" value={qty} onChange={e=>sQty(e.target.value)} style={{...CeS,width:48,padding:8,fontSize:16}}/><Mn sz={16} c="#ffd60a">{Math.round(ALC[sel]*(+qty||1))}</Mn></div><button onClick={add} style={BTS}>Log</button></div>}</Bx>
    {dr.length>0&&<Bx><Hd>Tonight</Hd>{dr.map((d,i)=> <div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderTop:i?"1px solid #111":"none"}}><span style={{fontSize:14}}>{d.name} √ó{d.qty}</span><div style={{display:"flex",alignItems:"center",gap:8}}><Mn sz={13} c="#ffd60a">{d.cal*d.qty}</Mn><button onClick={()=>rm(i)} style={{background:"none",border:"none",color:"#222",cursor:"pointer",fontSize:16}}>√ó</button></div></div>)}</Bx>}</div>;}

function CT({E,td,set,close}){const[am,sAm]=useState(td.wAM?.toString()||"");const[pm,sPm]=useState(td.wPM?.toString()||"");
  const sv=(f,v)=>{const n=parseFloat(v);if(!isNaN(n)&&n>50)set(p=>({...p,[f]:n}));};
  return <div><h2 style={{fontSize:22,fontWeight:700,marginBottom:16}}>Close Your Day</h2>
    <Bx><Hd>Morning Weight</Hd><div style={{display:"flex",gap:8}}><input type="number" inputMode="decimal" value={am} onChange={e=>sAm(e.target.value)} placeholder="e.g. 152" style={{...IS,flex:1,fontSize:20,fontFamily:"monospace"}}/><button onClick={()=>sv("wAM",am)} style={{background:"#e8372c",borderRadius:12,color:"#fff",padding:"14px 20px",fontSize:14,fontWeight:700,cursor:"pointer",border:"none"}}>Save</button></div>{td.wAM&&<div style={{fontSize:12,color:"#30d158",marginTop:8}}>‚úì {td.wAM} lbs</div>}</Bx>
    <Bx><Hd>Night Weight</Hd><div style={{display:"flex",gap:8}}><input type="number" inputMode="decimal" value={pm} onChange={e=>sPm(e.target.value)} placeholder="e.g. 155" style={{...IS,flex:1,fontSize:20,fontFamily:"monospace"}}/><button onClick={()=>sv("wPM",pm)} style={{background:"#e8372c",borderRadius:12,color:"#fff",padding:"14px 20px",fontSize:14,fontWeight:700,cursor:"pointer",border:"none"}}>Save</button></div>{td.wPM&&<div style={{fontSize:12,color:"#30d158",marginTop:8}}>‚úì {td.wPM} lbs</div>}</Bx>
    <Bx style={{background:"#0d1a0d",borderColor:"#30d15830"}}><Hd>Summary</Hd><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,fontSize:13}}><div><span style={{color:"#444"}}>Food: </span><span style={{fontWeight:600}}>{E.fCal}</span></div><div><span style={{color:"#444"}}>Alcohol: </span><span style={{fontWeight:600,color:E.dCal?"#ffd60a":"#30d158"}}>{E.dCal}</span></div><div><span style={{color:"#444"}}>Burned: </span><span style={{fontWeight:600,color:"#ff9f0a"}}>{E.wCal}</span></div><div><span style={{color:"#444"}}>Protein: </span><span style={{fontWeight:600}}>{E.fP}g</span></div></div><div style={{textAlign:"center",marginTop:14}}><div style={{fontSize:28,fontWeight:800,fontFamily:"monospace",color:E.net<0?"#30d158":"#e8372c"}}>{E.net>0?"+":""}{E.net}</div></div></Bx>
    <button onClick={close} style={{...BTS,background:"#30d158",fontSize:16,padding:16,borderRadius:14}}>Close Day & Get Grade</button><button onClick={close} style={{...BTS,background:"#111",color:"#666",fontSize:13}}>Skip weight & close</button></div>;}

function ST({E,prof,logs}){return <div><Bx style={{textAlign:"center",padding:22}}><Hd>Projection</Hd><div style={{fontSize:24,fontWeight:700,color:E.onT?"#30d158":"#e8372c",marginTop:4}}>{E.proj?E.proj.toLocaleDateString("en-US",{month:"long",day:"numeric"}):"Need Data"}</div></Bx>
  <Bx style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:18}}><div><div style={{fontSize:10,color:"#333"}}>Days</div><Mn sz={24}>{Object.keys(logs).length}</Mn></div><div><div style={{fontSize:10,color:"#333"}}>Lost</div><Mn sz={24} c={prof.sw-E.cw>0?"#30d158":"#e8372c"}>{(prof.sw-E.cw).toFixed(1)}</Mn></div><div><div style={{fontSize:10,color:"#333"}}>Rate</div><Mn sz={24} c="#ff9f0a">{E.wLR.toFixed(1)}</Mn></div><div><div style={{fontSize:10,color:"#333"}}>Weeks</div><Mn sz={24} c="#0a84ff">{E.wks<99?E.wks.toFixed(0):"‚Äî"}</Mn></div></Bx>
  <Bx><Hd>Profile</Hd><div style={{fontSize:13,color:"#666",lineHeight:1.7}}>{Math.floor(prof.hIn/12)}‚Äô{prof.hIn%12}" ¬∑ {prof.cBF}%‚Üí{prof.gBF}% ¬∑ TDEE:{prof.tdee} ¬∑ Cal:{prof.calT} ¬∑ Pro:{prof.proT}g</div></Bx></div>;}

function SE({prof,logout}){return <div><h2 style={{fontSize:22,fontWeight:700,marginBottom:16}}>Settings</h2>
  <Bx><Hd>Account</Hd><div style={{fontSize:15,fontWeight:600,marginBottom:4}}>{prof.name}</div><div style={{fontSize:12,color:"#444"}}>{Math.floor(prof.hIn/12)}‚Äô{prof.hIn%12}" ¬∑ {prof.w}lbs ‚Üí {prof.gw}lbs</div></Bx>
  <Bx><Hd>Plan</Hd><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,fontSize:13}}><div><span style={{color:"#444"}}>Calories: </span><span style={{fontWeight:600}}>{prof.calT}</span></div><div><span style={{color:"#444"}}>Protein: </span><span style={{fontWeight:600}}>{prof.proT}g</span></div><div><span style={{color:"#444"}}>TDEE: </span><span style={{fontWeight:600}}>{prof.tdee}</span></div><div><span style={{color:"#444"}}>Split: </span><span style={{fontWeight:600}}>PPL</span></div></div></Bx>
  <button onClick={logout} style={{...BTS,background:"#e8372c",fontSize:16,padding:16,borderRadius:14}}>Log Out</button>
  <div style={{fontSize:11,color:"#333",textAlign:"center",marginTop:12}}>Log out to switch accounts or let a friend create theirs</div></div>;}
